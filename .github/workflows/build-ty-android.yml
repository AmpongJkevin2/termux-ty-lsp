name: Build Test Executable

on:
  workflow_dispatch:

jobs:
  build-hello-for-android:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Rust manually
      # We keep this step to ensure the environment is as identical as possible to the failing `ty` build.
      run: |
        curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y --default-toolchain stable
        echo "$HOME/.cargo/bin" >> $GITHUB_PATH
        rustup target add aarch64-linux-android

    - name: Set up Android NDK manually
      run: |
        wget https://dl.google.com/android/repository/android-ndk-r26d-linux.zip
        unzip -q android-ndk-r26d-linux.zip
        echo "NDK_PATH=$GITHUB_WORKSPACE/android-ndk-r26d" >> $GITHUB_ENV

    - name: Build 'hello.c'
      run: |
        # Use the clang from the NDK to compile hello.c into an executable named 'hello'
        ${{ env.NDK_PATH }}/toolchains/llvm/prebuilt/linux-x86_64/bin/aarch64-linux-android34-clang hello.c -o hello

    - name: Upload 'hello' binary
      uses: actions/upload-artifact@v4
      with:
        name: hello-android-binary
        path: ./hello
